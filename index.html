<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendar Countdown</title>
<style>
  :root {
    --bg-color: white;
    --text-color: #222;
    --meta-color: #555;
    --count-color: #0b6b0b;
    --dl-bg: rgba(235,255,235,0.95);
    --dl-border: #0b6b0b;
    --other-bg: rgba(235,235,255,0.95);
    --other-border: #0b0bb6;
    --soon-border: rgba(230,126,34,1);
    --soon-shadow: rgba(230,126,34,0.5);
  }

  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: background 0.3s, color 0.3s;
  }

  h1 {
    text-align: center;
    margin-top: 10px;
  }

  .filters {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 5px;
    position: sticky;
    top: 0;
    background: var(--bg-color);
    padding: 10px 0;
    z-index: 100;
  }

  .filters button, .filters input[type="date"] {
    padding: 6px 12px;
    font-size: 0.9em;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #0b6b0b;
    background: #f0f0f0;
    transition: all 0.3s;
  }

  .filters button.active {
    background: #0b6b0b;
    color: white;
    border-color: #0b6b0b;
  }

  .container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
  }

  .column {
    display: flex;
    flex-direction: column;
  }

  .event {
    border:1px solid #ccc;
    padding:12px;
    margin:10px 0;
    border-radius:6px;
    background: rgba(255,255,255,0.95);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    opacity: 0;
    transform: translateY(5px);
    transition: all 0.3s ease, background 0.3s, border-color 0.3s, box-shadow 0.3s;
  }

  .event.show {
    opacity: 1;
    transform: translateY(0);
  }

  .distance-learning {
    background: var(--dl-bg);
    border-color: var(--dl-border);
  }

  .other {
    background: var(--other-bg);
    border-color: var(--other-border);
  }

  .event.starting-soon {
    border-color: var(--soon-border);
    box-shadow: 0 2px 6px var(--soon-shadow);
  }

  .meta {font-size:0.9em; color:var(--meta-color); margin-top:6px;}
  .count {font-weight:700; color:var(--count-color); margin-top:6px;}
  small {color:#666;}

  .no-events {
    font-style: italic;
    color: #888;
    margin: 15px 0;
    text-align: center;
  }

  .dark-mode {
    --bg-color: #1c1c1c;
    --text-color: #eee;
    --meta-color: #aaa;
    --count-color: #39ff14;
    --dl-bg: rgba(10,50,10,0.9);
    --dl-border: #0b6b0b;
    --other-bg: rgba(20,20,80,0.9);
    --other-border: #0b0bb6;
    --soon-border: rgba(255,165,0,1);
    --soon-shadow: rgba(255,165,0,0.5);
  }

  @media screen and (max-width: 768px) {
    .container {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<h1>Upcoming Events Countdown</h1>

<div class="filters" role="region" aria-label="Time Filters">
  <button data-filter="today" class="active">Today</button>
  <button data-filter="week">This Week</button>
  <button data-filter="month">This Month</button>
  <button data-filter="all">All</button>
  <input type="date" id="date-picker" aria-label="Select Date">
</div>

<div class="filters" role="region" aria-label="Type Filters">
  <button data-type="all" class="active">All</button>
  <button data-type="dl">Distance Learning</button>
  <button data-type="other">Other</button>
  <button id="dark-toggle">Dark Mode</button>
</div>

<div class="container">
  <div class="column" id="dl-list"></div>
  <div class="column" id="other-list"></div>
</div>

<script>
const JSON_FILE = 'https://roy1sarkis99-svg.github.io/event-countdown/converted_calendar.json';
const REM_KEY = 'countdown_reminders_v6';
let renderedHash = null;
let tickIntervals = [];
let currentTimeFilter = localStorage.getItem('timeFilter') || 'today';
let currentTypeFilter = localStorage.getItem('typeFilter') || 'all';
let selectedDate = null;

if ('Notification' in window && Notification.permission === 'default') Notification.requestPermission();

function notify(title, body) {
    if (Notification.permission === 'granted') new Notification(title, {body});
    else console.log('Notify:', title, body);
}

function formatDateDDMM(dateStr) {
    if (!dateStr) return '';
    const d = new Date(dateStr);
    const p = n => n.toString().padStart(2,'0');
    return `${p(d.getDate())}/${p(d.getMonth()+1)}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}`;
}

function clearTicks() { tickIntervals.forEach(id => clearInterval(id)); tickIntervals = []; }

function filterEvent(ev) {
    const now = new Date();
    const start = new Date(ev.start);
    const evText = (ev.summary || '') + ' ' + (ev.description || '');
    const isDL = /distance learning/i.test(evText);

    // Time filter
    let timeOk = false;
    if(selectedDate) timeOk = start.toDateString() === selectedDate.toDateString();
    else switch(currentTimeFilter){
        case 'today': timeOk = start.toDateString() === now.toDateString(); break;
        case 'week': {
            const weekEnd = new Date(); weekEnd.setDate(now.getDate() + (7 - now.getDay())); 
            timeOk = start >= now && start <= weekEnd; break;
        }
        case 'month': timeOk = start.getFullYear() === now.getFullYear() && start.getMonth() === now.getMonth(); break;
        case 'all': timeOk = true; break;
    }

    // Type filter
    let typeOk = (currentTypeFilter==='all') || (currentTypeFilter==='dl' && isDL) || (currentTypeFilter==='other' && !isDL);

    return timeOk && typeOk && new Date(ev.start).getTime() > Date.now();
}

// Dark mode setup
if(localStorage.getItem('darkMode')==='true') document.body.classList.add('dark-mode');

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}

document.getElementById('dark-toggle').addEventListener('click', toggleDarkMode);

// More JS (renderEvents, fetchAndRender, ticks, filters, etc.) will be included next.  

</script>
</body>
</html>
